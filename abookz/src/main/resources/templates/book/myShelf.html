<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head}">
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div th:replace="~{fragments/header :: header}" /><br>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script type="text/javascript" src="/lib/jquery-3.7.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

<div id="shelf_container" class="shelf_container">
    <div id="shelf_left">
<hr class="shelfLeft_hr">
    <p class="bookShelves">내 서재들</p>
    <a href="/myshelf/tag/ALL" class="myShelf_" th:text="'전체(' + ${all.size()} + ')'">1</a>
    <br>
    <a href="/myshelf/tag/READ" class="myShelf_" th:text="'읽은 책(' + ${read} + ')'">1</a>
    <br>
    <a href="/myshelf/tag/WANT_TO_READ" class="myShelf_" th:text="'읽고싶은 책(' + ${want} + ')'">1</a>
    <br>
    <a href="/myshelf/tag/CURRENTLY_READING" class="myShelf_" th:text="'읽고있는 책(' + ${current} + ')'">1</a>
    <hr class="shelf_left_center">
    <p class="bookShelves">읽기 활동</p>
    <a href="#" class="myShelf_" th:text="'나의 리뷰(' + ${books.size()} + ')'">1</a>
    <br>
    <a href="/memo/all" class="myShelf_" th:text="'나의 메모(' + ${books.size()} + ')'">1</a>
    <br>
    <a href="#" class="myShelf_" th:text="'나의 챌린지(' + ${books.size()} + ')'">1</a>
    <br>
    </div>
<div id="shelf_center">
    <button class="btn btn-secondary mr-5" id="largeButton">간략히</button>
    <button class="btn btn-primary" id="smallButton">자세히</button>
    <hr class="myShelf_hr">
    <br>
        <div class="overflow-x-auto" id="myShelfDiv">
        <table class="table">
        <thead>
        <tr class="shelf_tr">
            <th class="shelf_th text-center"># </th>
            <th class="shelf_th text-center">이미지</th>
            <th class="shelf_th text-center">제목</th>
            <th class="shelf_th text-center">작가</th>
            <th class="shelf_th text-center w-28">진행량</th>
            <th class="shelf_th text-center w-28">서재</th>
            <th class="shelf_th text-center w-28">시작일</th>
            <th class="shelf_th text-center w-28">완독일</th>
            <th class="shelf_th text-center">상세보기</th>
            <th class="shelf_th text-center">리뷰작성</th>
            <th class="shelf_th text-center">삭제</th>
            </tr>
        </thead>
        <tbody>
        <tr class="myShelf_tr" th:each=" book: ${books}">
            <td class="shelf_th text-center" th:text="${bookStat.count}">1</td>
            <td class="shelf_tdimg text-center">
                <img class="cover_img " th:src="${book.cover}" alt="책이미지"></td>
            <td class="shelf_title text-center">
                <a th:href="@{'/content/' + ${book.getISBN13()}}" th:text="${#strings.length(book.title) > 13 ? #strings.substring(book.title, 0, 13) + '...' :
            (#strings.contains(book.title, '(') ? #strings.substringBefore(book.title, '(') :
            (#strings.contains(book.title, '-') ? #strings.substringBefore(book.title, '-') : book.title))}">제목</a>
            </td>
            <td class="shelf_author text-center" th:text="${#strings.length(book.author) > 10 ? #strings.substring(book.author, 0, 10) + '...' :
                                 (#strings.contains(book.author, '(') ? #strings.substringBefore(book.author, '(') : book.author)}">작가</td>
            <td class="shelf_page text-center w-28" th:text="${ (shelf[bookStat.index].currentPage == null ? '0' : shelf[bookStat.index].getCurrentPage()) + ' / ' + book.itemPage}">페이지</td>
            <td class="shelf_myShelf_read text-center w-28" th:text="${shelf[bookStat.index].tag == null ? '읽고싶은 책' : shelf[bookStat.index].tag.getKorean()}">상태</td>
            <div class="popup" th:attr="data-value=${shelf[bookStat.index].getId()}">
                <input type="radio" id="value1" name="stats" value="READ">
                <label for="value1">읽은 책</label><br>
                <input type="radio" id="value2" name="stats" value="WANT_TO_READ">
                <label for="value2">읽고 싶은 책</label><br>
                <input type="radio" id="value3" name="stats" value="CURRENTLY_READING">
                <label for="value3">읽고 있는 책</label>
            </div>
            <td class="shelf_myShelf_add text-center w-28"  th:text="${shelf[bookStat.index].startDate == null ? '- ' : #temporals.format(shelf[bookStat.index].startDate,('yyyy-MM-dd'))}">추가일</td>
            <td class="shelf_myShelf_start text-center w-28" th:text="${shelf[bookStat.index].endDate == null ? '-' : #temporals.format(shelf[bookStat.index].endDate,('yyyy-MM-dd'))}">완료일</td>
            <td class="shelf_myShelf_update text-center"> <button class="btn btn-primary btn-detail"> 상세보기</button></td>
            <td class="shelf_myShelf_review text-center" ><a th:href="@{/review/{bookShelfId}/{bookId}(bookShelfId=${shelf[bookStat.index].getId()},bookId=${book.getId()})}">리뷰</a></td>
            <td class="shelf_myShelf_delete text-center" th:attr="data-value=${shelf[bookStat.index].getId()}" ><button class="btn btn-square btn-outline">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>   </td>

        </tr>
        </tbody>
    </table>
    </div>
    <div id="myShelfListWrap">
        <div id="booklist" class="card card-side bg-base-100 shadow-xl w-3/4 mb-2  mx-auto" th:each=" shelfslice: ${shelfSlice}">
            <input type="hidden" class="wrap_popup" th:attr="data-value=${shelfslice.id}"/>
            <figure><img class="w-40" th:src="${shelfslice.getBookDTO().cover}" alt="cover"/></figure>
            <div class="card-body">
                <span class="text-center mb-2 font-extrabold text-lg" th:text="${#strings.length(shelfslice.getBookDTO().title) > 40 ? #strings.substring(shelfslice.getBookDTO().title, 0, 40) + '...' : shelfslice.getBookDTO().title}">New movie is released!</span>
                    <span th:text="${shelfslice.getBookDTO().author}">작가</span>
                <div class="progressWrap-bar"><div class="progressWrap"></div></div>
                <span class="myShelfWrapPage" th:attr="itemPage=${shelfslice.getBookDTO().itemPage}, currentPage=${shelfslice.currentPage}" th:text="'읽은 페이지 :'+${ (shelfslice.currentPage == null ? '0' : shelfslice.currentPage) + ' / ' + shelfslice.getBookDTO().itemPage}">페이지</span>
            </div>
                <div class="flex flex-col justify-end">
                    <div class="myShelf_wrap_delete flex-1 m-0" th:attr="data-value=${shelfslice.id}" ><button class="btn btn-square btn-outline">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>  </div>
                    <div class="shelf_myShelf_review flex-1"> <a th:href="@{/review/{bookShelfId}/{bookId}(bookShelfId=${shelfslice.id},bookId=${shelfslice.getBookDTO().id})}" class="btn btn-primary btn-reivew"> 리뷰</a></div>
                    <div class="myShelf_wrap_update flex-1"> <button class="btn btn-primary btn-detail"> 상세보기</button></div>
                </div>

        </div>

    </div>

    <button id="moreSlice" onclick="loadMoreBooks()"> 더보기 </button>
    </div>
    <!-- 모달 -->
    <div class="modal" id="myModal">
        <div id="modal_content">
        </div>
    </div>

            </div>
        </div>

<script src="/js/myShelfChange.js"></script>
<script src="/js/myShelf.js"></script>
<script src="/js/myShelfModal.js"></script>

<div id="searchResults"></div>
<script defer src="/js/index.js"></script>
</body>
</html>