<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head}">
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<div th:replace="~{fragments/header :: header}" /><br>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script type="text/javascript" src="/lib/jquery-3.7.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

<div id="shelf_container" class="shelf_container">
    <div id="shelf_left">
        <hr class="shelfLeft_hr">
        <p class="bookShelves">내 서재들</p>
        <a th:if="${tagValue}" href="/myshelf/tag/ALL" class="myShelf_" th:text="'전체(' + ${read+want+current} + ')'">1</a>
        <a th:unless="${tagValue}" href="/myshelf/tag/ALL" class="myShelf_" th:text="'전체(' + ${books.size()} + ')'">1</a>
        <br>
        <a href="/myshelf/tag/READ" class="myShelf_" th:text="'읽은 책(' + ${read} + ')'">1</a>
        <br>
        <a href="/myshelf/tag/WANT_TO_READ" class="myShelf_" th:text="'읽고싶은 책(' + ${want} + ')'">1</a>
        <br>
        <a href="/myshelf/tag/CURRENTLY_READING" class="myShelf_" th:text="'읽고있는 책(' + ${current} + ')'">1</a>
        <hr class="shelf_left_center">
        <p class="bookShelves">읽기 활동</p>
        <a href="/review/reviewList" class="myShelf_" th:text="'나의 리뷰'">1</a>
        <br>
        <a href="/memo/all" class="myShelf_" th:text="'나의 메모'">1</a>
        <br>
        <a href="#" class="myShelf_" th:text="'나의 챌린지'">1</a>
        <br>
    </div>

    <div id="shelf_center">
        <hr class="myShelf_hr">
        <br>
        <div class="overflow-x-auto" id="myShelfDiv">
            <table class="table">
                <thead>
                <tr class="shelf_tr">
                    <th class="shelf_th text-center"> # </th>
                    <th class="shelf_th text-center w-12">이미지</th>
                    <th class="shelf_th text-center w-50">제목</th>
                    <th class="shelf_th text-center w-28">서재</th>
                    <th class="shelf_th text-center w-14">페이지</th>
                    <th class="shelf_th text-center w-50">인용구</th>
                    <th class="shelf_th text-center w-50">나의 메모</th>
                    <th class="shelf_th text-center w-12">메모 수</th>
                </tr>
                </thead>
                <tbody th:each="shelf, index : ${shelves}" th:with="count=${memoCount[__${index.index}__]}, memo=${memos[__${index.index}__]}">
                <tr class="myShelf_tr" th:if="${count > 0}">
                    <td class="shelf_th text-center" th:text="${index.index + 1}">1</td>
                    <td class="shelf_tdimg text-center"><img class="cover_img" th:src="${shelf.getBookDTO().getCover()}" alt="책이미지"></td>
                    <td class="shelf_title text-center" th:text="${#strings.contains(shelf.getBookDTO().getTitle, '(') ? #strings.substringBefore(shelf.getBookDTO().getTitle, '(') : #strings.contains(shelf.getBookDTO().getTitle, '-') ? #strings.substringBefore(shelf.getBookDTO().getTitle, '-') : shelf.getBookDTO().getTitle}">제목</td>
                    <td class="shelf_myShelf_read text-center" th:text="${shelf.tag == null ? '읽고싶은 책' : shelf.tag.getKorean()}"></td>
                    <td class="shelf_page text-center" th:text="${memo.page == null ? '-' : memo.page}">페이지</td>
                    <td class="shelf_page text-center" th:text="${memo.quotes == null ? '-' : memo.quotes.length() > 20 ? memo.quotes.substring(0, 20) + '...' : memo.quotes}">인용구</td>
                    <td class="shelf_page text-center" th:text="${memo.note.length() > 20 ? memo.note.substring(0, 20) + '...' : memo.note}">노트</td>
                    <td class="shelf_page text-center">
                        <span th:if="${count == 0}" th:text="${count}"></span>
                        <a th:unless="${count == 0}" th:href="@{|/memo/${shelf.id}|}" th:text="${count}" ></a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <script  src="/js/myShelf.js"></script>
</div>
<div id="searchResults"></div>
<script defer src="/js/index.js"></script>
<script src="/js/myShelfChange.js"></script>
<script src="/js/myShelf.js"></script>
<script src="/js/myShelfModal.js"></script>
</body>
</html>